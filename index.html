<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Araç Analiz Sistemi</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

<style>
body {
  font-family: Arial;
  background: linear-gradient(120deg,#0a58ff,#2bbcff);
  padding: 40px;
}
.container {
  max-width: 420px;
  margin: auto;
}
.card {
  background: white;
  padding: 20px;
  border-radius: 10px;
  margin-bottom: 20px;
}
input, select, button {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
}
button {
  background: #0a58ff;
  color: white;
  border: none;
  font-weight: bold;
}
</style>
</head>

<body>

<div class="container">

<!-- PLAKA SORGULAMA -->
<div class="card">
<h3>Plaka Sorgu</h3>
<input id="plakaSorgu" placeholder="Plaka">
<button onclick="analiz()">Analiz Oluştur</button>
<button onclick="tekSorgu()">Tek Sorgu Satın Al (30 TL)</button>
<button onclick="uyelik()">Aylık Üyelik Al</button>
<button onclick="cikis()">Çıkış Yap</button>
</div>

<!-- ADMIN PANEL -->
<div class="card">
<h3>Admin Panel — Araç Ekle</h3>

<form id="vehicleForm">

<input type="text" id="plaka" placeholder="Plaka" required>

<select id="marka" required></select>
<select id="model" required></select>
<select id="yil" required></select>

<input type="number" id="km" placeholder="Kilometre">

<label>Ekspertiz Raporu</label>
<input type="file" id="expertiz" accept="image/*">

<button type="submit">Kaydet</button>

</form>
</div>

</div>

<script>
// SUPABASE AYARLARIN
const supabaseUrl = "https://lxuqpziqyrrwtzcksgwz.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx4dXFwemlxeXJyd3R6Y2tzZ3d6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1NDM4MzMsImV4cCI6MjA4NjExOTgzM30.WOwK1D4eDNyPxYOe7HUuwndgPFQgmdmCcRxWsfyTSps";
const sb = supabase.createClient(supabaseUrl, supabaseKey);


// MARKA MODEL DATA
const cars = {
  BMW: ["1 Serisi","3 Serisi","5 Serisi","X1","X3","X5"],
  Mercedes: ["A","C","E","CLA","GLA","GLC"],
  Audi: ["A3","A4","A6","Q2","Q3","Q5"],
  Volkswagen: ["Polo","Golf","Passat","Tiguan"],
  Hyundai: ["i10","i20","i30","Elantra","Tucson"],
  Renault: ["Clio","Megane","Taliant","Captur"],
  Fiat: ["Egea","Panda","500"],
  Toyota: ["Corolla","Yaris","C-HR"],
  Honda: ["Civic","City","HR-V"]
};


// MARKA DOLDUR
const markaSelect = document.getElementById("marka");
markaSelect.innerHTML = <option value="">Marka Seç</option>;
Object.keys(cars).forEach(marka => {
  markaSelect.innerHTML += <option>${marka}</option>;
});


// MODEL DOLDUR
markaSelect.addEventListener("change", () => {
  const modelSelect = document.getElementById("model");
  modelSelect.innerHTML = <option value="">Model Seç</option>;
  cars[markaSelect.value].forEach(model => {
    modelSelect.innerHTML += <option>${model}</option>;
  });
});


// YIL LİSTESİ
const yilSelect = document.getElementById("yil");
yilSelect.innerHTML = <option value="">Yıl Seç</option>;
for (let i = 2025; i >= 1995; i--) {
  yilSelect.innerHTML += <option>${i}</option>;
}


// ARAÇ EKLE
document.getElementById("vehicleForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const file = document.getElementById("expertiz").files[0];
  let imageUrl = null;

  if (file) {
    const fileName = Date.now() + "_" + file.name;
    const { error } = await sb.storage.from("expertiz").upload(fileName, file);
    if (!error) {
      imageUrl = sb.storage.from("expertiz").getPublicUrl(fileName).data.publicUrl;
    }
  }

  const { error } = await sb.from("vehicles").insert({
    plaka: document.getElementById("plaka").value,
    marka: document.getElementById("marka").value,
    model: document.getElementById("model").value,
    yil: document.getElementById("yil").value,
    km: document.getElementById("km").value,
    expertiz_url: imageUrl
  });

  if (!error) {
    alert("Araç eklendi");
    location.reload();
  } else {
    alert("Hata oluştu");
  }
});


// ANALİZ
async function analiz(){
  const plaka = document.getElementById("plakaSorgu").value;

  const { data } = await sb
    .from("vehicles")
    .select("*")
    .eq("plaka", plaka)
    .single();

  if(data){
    alert("Araç bulundu: " + data.marka + " " + data.model);
  }else{
    alert("Araç bulunamadı");
  }
}


// SADE BUTONLAR
function tekSorgu(){ alert("iyzico bağlanınca aktif"); }
function uyelik(){ alert("iyzico bağlanınca aktif"); }
function cikis(){ location.reload(); }

</script>
</body>
</html>
